{% load static wagtailcore_tags socialaccount %}
<nav id="navBar" class="sticky relative top-0 z-[1] border-b-1/2 border-bf2042-3 bg-card-bg shadow-bf2042-3 flex items-center w-full gap-x-6 px-6 py-4 hover:shadow hover:shadow-bf2042-4 transition-shadow duration-200">
    <a class="flex basis-auto group text-white flex-nowrap " href="/">
                <img class="fill-current h-8 w-8 mr-2" width="54" height="54"
                     src="{% static 'images/bf_portal_logo_bc.png' %}"
                     alt=""/>
                <span class="shrink-0 font-semibold text-2xl tracking-tight group-hover:text-bf2042-4 transition duration-200 ease-in-out drop-shadow-[0_0_2.5px_#ffffff] hover:drop-shadow-[0_0_2.5px_#08A696]">BF Portal</span>
    </a>
    <div class="flex flex-grow items-center">
        <div class="hidden text-base md:flex-grow md:flex content-center">
            <a href="/experiences/"
               class="block lg:inline-block lg:mt-0 text-teal-200 hover:text-bf2042-5 mr-4 transition duration-200 ease-in-out">
                Library
            </a>
            <a href="#"
               class="block lg:inline-block lg:mt-0 text-teal-200 hover:text-bf2042-5 mr-4 transition duration-200 ease-in-out">
                Docs
            </a>
            <a href="/experiences/featured"
               class="block lg:inline-block lg:mt-0 text-teal-200 hover:text-bf2042-5 mr-4 transition duration-200 ease-in-out">
                Featured
            </a>
            <a href="/submit/"
               class="inline-block lg:inline-block lg:mt-0 text-teal-200 hover:text-white  rounded-lg mr-4 hover:text-bf2042-6 transition duration-200 ease-in-out">
                Submit Experience
            </a>
            {% if page.is_experience_page and  page.owner == request.user %}
                <a href="edit/"
                   class="block lg:inline-block lg:mt-0 text-teal-200 hover:text-bf2042-5 mr-4 transition duration-200 ease-in-out">
                    Edit Experience
                </a>
            {% endif %}
            <a href="https://gametools.network/servers?game=bf2042&region=all&platform=pc&limit=10"
               target="_blank"
               class="cursor-alias inline-block lg:inline-block lg:mt-0 text-teal-200 hover:text-white  rounded-lg mr-4 hover:text-bf2042-6 transition duration-200 ease-in-out">
                Server Browser
            </a>
            {% block extend_navbar %}

            {% endblock %}
        </div>
        <div class="flex flex-grow justify-end">
            {% if request.user.is_authenticated %}
                {% get_social_accounts user as accounts %}
                {% if accounts %}
                    {% with account=accounts.discord.0 %}
                        <div id="profileButton"
                             class="hidden profileButton relative inline-block group px-4 py-1 leading-none border rounded text-bf2042-4 border-hover-bg-light md:block hover:border-transparent hover:text-bf2042-6 hover:bg-hover-bg-light transition duration-200 ease-in-out">
                            <div class="w-max">
                                {% if account.extra_data.avatar %}
                                    <img src="{{ account.get_avatar_url }}" class="block rounded-full " width="30" alt="@p"/>
                                {% else %}
                                    <img src="{% static 'images/default_discord_avatar.png' %}" class="inline rounded-full" width="30" alt="@p"/>
                                {% endif %}
                            </div>
                            <div id="myDropdown"
                                 class="dropdown-content flex flex-col text-center text-md gap-y-2 bg-card-bg p-2 -top-2.5 rounded-lg absolute -left-1 text-white invisible">
                                <a href="/users/{{ account.uid }}">Profile</a>
                                <a href="/logout" class="text-red-400">Logout</a>
                            </div>
                        </div>
                    {% endwith %}
                {% endif %}
            {% else %}
                <a href="{% provider_login_url 'discord' process='login' %}"
                   class="hidden md:inline-block text-sm px-4 py-2 leading-none border rounded text-white border-white hover:border-transparent hover:text-teal-500 hover:bg-white  lg:mt-0">Login</a>
            {% endif %}
            <div id="menuIcon" class="group flex flex-col gap-y-1 cursor-pointer md:hidden">
                <div class="w-4 h-0.5 rounded-lg bg-bf2042-4 group-hover:bg-bf2042-6 transition duration-200 ease-in-out"></div>
                <div class="w-4 h-0.5 rounded-lg bg-bf2042-4 group-hover:bg-bf2042-6 transition duration-200 ease-in-out"></div>
                <div class="w-4 h-0.5 rounded-lg bg-bf2042-4 group-hover:bg-bf2042-6 transition duration-200 ease-in-out"></div>
            </div>
            <div id="nav-bar-pane" class="hidden flex flex-col absolute bg-card-bg top-full right-0 backdrop-brightness-50 items-center md:hidden">
                <div class="flex flex-col items-end  text-lg ml-4 mr-2 gap-y-2 mt-2">
                    <a href="/experiences/"
                       class="text-teal-200 hover:text-bf2042-5 transition duration-200 ease-in-out rounded-[0px] border-b-2 border-white">
                        Library
                    </a>
                    <a href="#"
                       class="text-teal-200 hover:text-bf2042-5 transition duration-200 ease-in-out rounded-[0px]  border-b-2 border-white">
                        Docs
                    </a>
                    <a href="/experiences/featured"
                       class="text-teal-200 hover:text-bf2042-5  transition duration-200 ease-in-out rounded-[0px] border-b-2 border-white">
                        Featured
                    </a>
                    <a href="/submit/"
                       class="lg:mt-0 text-teal-200 hover:text-white  rounded-lg  hover:text-bf2042-6 transition rounded-[0px] duration-200 ease-in-out border-b-2 border-white">
                        Submit Experience
                    </a>
                    {% if page.is_experience_page and  page.owner == request.user %}
                        <a href="edit/"
                           class="text-teal-200 hover:text-bf2042-5 transition duration-200 ease-in-out rounded-[0px] border-b-2 border-white">
                            Edit Experience
                        </a>
                    {% endif %}
                    <a href="https://gametools.network/servers?game=bf2042&region=all&platform=pc&limit=10"
                       target="_blank"
                       class="cursor-alias lg:mt-0 text-teal-200 hover:text-white  rounded-lg  hover:text-bf2042-6 transition rounded-[0px] duration-200 ease-in-out border-b-2 border-white">
                        Server Browser
                    </a>
                    {% if request.user.is_authenticated %}
                        {% get_social_accounts user as accounts %}
                        {% if accounts %}
                            {% with account=accounts.discord.0 %}
                                <a class="lg:mt-0 text-teal-200 hover:text-white  rounded-lg  hover:text-bf2042-6 transition rounded-[0px] duration-200 ease-in-out border-b-2 border-white" href="/users/{{ account.uid }}">Profile</a>
                                <a class="lg:mt-0 text-teal-200 hover:text-white  rounded-lg  hover:text-bf2042-6 transition rounded-[0px] duration-200 ease-in-out border-b-2 border-white" href="/logout/" >Logout</a>
                            {% endwith %}
                        {% endif %}
                    {% else %}
                        <a href="{% provider_login_url 'discord' process='login' %}"
                           class="lg:mt-0 text-teal-200 hover:text-white  rounded-lg  hover:text-bf2042-6 transition rounded-[0px] duration-200 ease-in-out border-b-2 border-white">Login</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</nav>
<script>
    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function toggleDropdown() {
        const drpDown = document.getElementById("myDropdown")
        drpDown.classList.toggle("invisible");
        drpDown.style.opacity = '0%';
        drpDown.style.left = '0';
        anime({
            targets: '#myDropdown',
            opacity: '100%',
            left: '-5rem',
            easing: 'easeOutQuint',
        });

    }

    document.getElementById('profileButton').addEventListener('click', toggleDropdown)
    document.getElementById("myDropdown").addEventListener('click', function (event) {
        event.stopPropagation();
    });
    // Close the dropdown if the user clicks outside of it
    window.onclick = function (event) {
        if (!event.target.closest('#profileButton')) {
            const pane = document.getElementById('myDropdown');
            if (!pane.classList.contains('invisible')) {
                pane.classList.add('invisible');
                pane.style.left = '-0.25rem';
            }
        }
    }
</script>
